<div id="box-<%= @idName %>" class="row-fluid">
  <div class="span12">
    <div class="row-fluid">
      <div class="span12">
        <h5 style="text-align: center">Origem: <%= @source.name %> | Destino: <%= @destination.name %> |
          Data: <%= @from.strftime('%Y-%m-%d %H:%M:%S %Z') %> à <%= @to.strftime('%Y-%m-%d %H:%M:%S %Z') %></h5>

        <div id="chart-<%= @idName %>" style="height:250px;"></div>
      </div>
    </div>
    <div class="row-fluid">
      <div class="span12">
        <div class="chart-bottom" style="padding-top: 10px;">
          <div class="btn btn-danger" style="float:right; margin-bottom: 20px" onclick="jQuery('#box-<%=@idName%>').remove();">Remover</div>
          <a id="export-<%= @idName %>" class="btn btn-success" style="float:right; margin-right: 5px ;margin-bottom: 20px" href="<%= reports_performance_export_url @exportFileName+".csv" %>?<%= params.to_query %>">Exportar
            CSV</a>
          <a id="exportxls-<%= @idName %>" class="btn btn-success" style="float:right; margin-right: 5px ;margin-bottom: 20px" href="<%= reports_xls_bruto_url @exportFileName+".xls" %>?<%= @exportParams %>">Exportar
            XLS</a>

          <div id="legend-<%= @idName %>" style="float:right; margin-right: 5px ;margin-bottom: 20px">Ponto Atual:</div>
        </div>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
<% case @metric.plugin %>
<% when 'rtt' %>
graphData["<%=@idName%>"] = [
        <% @raw_results.each do |res| %>
        [new Date("<%= res.timestamp.strftime("%b %d, %Y %H:%M:%S %z")%>"),<%=res.pretty_scalar_upload%>]<%=(res!=@results.last)?",":""%>
        <% end %>
    ];
<% else %>
graphData["<%=@idName%>"] = [
        <% @raw_results.each do |res| %>
        [new Date("<%= res.timestamp.strftime("%b %d, %Y %H:%M:%S %z")%>"),<%= res.pretty_scalar_download %>,<%= res.pretty_scalar_upload %>]<%=(res!=@results.last)?",":""%>
        <% end %>
    ];
<% end %>

graphs["<%=@idName%>"] = new Dygraph(document.getElementById("chart-<%=@idName%>"),
    graphData["<%=@idName%>"],
    {
        labels: <%= @labels.unshift('Data', 'uuid').to_json %>,
        visibility: <%= ([true]*@labels.count).unshift(false).to_json %>,
        labelsDiv: document.getElementById('legend-<%=@idName%>'),
        legend: "always",
        axisLabelFontSize: 10,
        ylabel: "<%=@metric.name%> (<%=@metric.view_unit%>)",
        yLabelWidth: 14,
        dateWindow: [Date.parse("<%=@from.strftime("%b %d, %Y %H:%M:%S %z")%>"), Date.parse("<%=@to.strftime("%b %d, %Y %H:%M:%S %z")%>")],
        clickCallback: function (e, x, pts) {
            if(params["<%=@idName%>"] != undefined) {
              jQuery(me).text("Atualizando os dados");
              jQuery.post('<%=performance_reports_url%>.json', params["<%=@idName%>"]).done(function (dataReturned) {
                jQuery.each(dataReturned.results, function(i,val) {
                  val[0] = new Date(val[0]);
                });
                graphData["<%=@idName%>"].shift();
                graphData["<%=@idName%>"]= graphData["<%=@idName%>"].concat(dataReturned.results);
                jQuery("#graph-date-<%=@idName%>").text("Data: "+moment(graphData["<%=@idName%>"][0][0]).format('YYYY-MM-DD HH:mm:ss Z')+" à "+moment.unix(dataReturned.to).format('YYYY-MM-DD HH:mm:ss Z'));
                graphs["<%=@idName%>"].updateOptions({'file':graphData["<%=@idName%>"],dateWindow: [graphData["<%=@idName%>"][0][0],moment.unix(dataReturned.to)]});
                var tempUpdtObj2 = jQuery.extend({},tempUpdtObj["<%=@idName%>"]);
                tempUpdtObj2.endDate = moment().add('m', <%= @window_size %>);
                jQuery("#update-<%=@idName%>").regressiveTimer(tempUpdtObj2);
              });
            }
        }
    });
</script>