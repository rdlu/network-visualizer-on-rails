<% uid = SecureRandom.uuid %>
<div id="box-<%= @to %>-<%= @from %>" class="row-fluid" xmlns="http://www.w3.org/1999/html"
     xmlns="http://www.w3.org/1999/html">
   <div id="table2-<%= uid %>" >
      <text style="color: #3E576F;font-size:  16px">Tabela de Indicadores Anatel tipo 2:  Início: <%= @from.strftime("%d/%m/%y") %> Fim: <%= @to.strftime("%d/%m/%y") %> </text>
      <table class="table table-bordered table-hover table-condensed" >
        <thead>
        <tr>
          <th></th>
          <%  Threshold.all.each do |threshold|
                if threshold.id == 1 || threshold.id == 2
          %>
              <th colspan="2" style="text-align: center"><%= threshold.description %></br> Meta: <%= threshold.compliance_level* 100 %>%</th>
                  <% else %>
              <th style="text-align: center"><%= threshold.description %></br> Meta: <%= threshold.compliance_level* 100 %>%</th>
          <% end
           end %>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td style="min-width: 50px"></td>
          <%  Threshold.all.each do |threshold|
                name = Array.new
                if threshold.id == 1 || threshold.id == 2
                    name = threshold.name.split('/') %>
                  <td style="text-align: center"><%= name[0] %> </td>
                  <td style="text-align: center"><%= name[1] %> </td>
               <% else %>
                  <td style="text-align: center"><%= threshold.name %> <br/></td>
               <% end %>
          <% end %>
        </tr>
        <% @months.each do |month| %>
            <tr  onclick="toggleTable2('<%= month.strftime("%Y-%m-%d")%>');">
              <td  style="font-weight: bold">
                <%= month.strftime("%b/%Y") == Time.new.strftime("%b/%Y") ? (month.strftime("%b/%Y")+' (Parcial)'):month.strftime("%b/%Y") %>&nbsp;&nbsp;<span class="icon-search" title="Detalhar"></span>
              </td>
              <%  Threshold.all.each do |threshold|
                   media_down = 0
                   media_up = 0
                   down = 0
                   up = 0
                   count_all_scm4 = 0
                   count_scm4=0
                   color_scm4 = "red"


                if threshold.id == 1
              %>
                  <td style="text-align: center">
                        <%= "<span style=\"color:green\">#{@report_results[:scm4][month.to_s][:total]}%</span>".html_safe %>
                  </td>
                  <td style="text-align: center">
                    <%= "<span style=\"color:green\">#{@report_results[:smp10][month.to_s][:total]}%</span>".html_safe %>
                  </td>
              <% end
                 end %>
            </tr>
            <tr id="<%= month.strftime("%Y-%m-%d")%>" style="display: none"  >
              <td  colspan="9" style="font-weight: bold; background-color: #777777;text-align: center">Diário <%= month.strftime("%B/%Y")%></td>
            </tr>
            <tbody colspan="9" style="display: none;" id="detail2<%= month.strftime("%Y-%m-%d")%>"></tbody>
        <% end %>
        </tbody>
        </table>
    </div>
</div>
<div id="remove-<%= uid %>"  class="btn btn-danger" style="float:right; margin-bottom: 20px" onclick="$('#table2-<%= uid %>').remove(); $(this).remove();">Remover</div>

<script>
    function toggleTable2(id){
        var e = document.getElementById(id);

        if (e.style.display == 'table-row'){
            e.style.display = 'none';
            document.getElementById('detail2'+id).style.display = 'none';

        }else{
            if($('#detail2'+id).is(':empty')){
                $.ajax({
                    dataType: '',
                    type: 'POST',
                    url: "<%= detail_eaq2_table_reports_url %>",
                    data: { compliance: <%= @compliances.to_json.html_safe %> ,month: id, goal_filter: <%= @goal_filter .to_json.html_safe %>,
                        agent: <%= @type.to_json.html_safe %>, agent_type: <%= @agent_type.to_json.html_safe %>, state: <%= @states.to_json.html_safe %>,
                        cn: <%= @cn.to_json.html_safe %>, probes: <%= @probes.to_json.html_safe %>, schedules: <%= @schedules.to_json.html_safe %>},
                    success: function(data){
                        $('#detail2'+id).html(data);
                    }
                });
            }
            e.style.display = 'table-row';
            jQuery('#detail2'+id).fadeIn('slow');
            //document.getElementById('detail'+id).style.display = '';

        }
    }
</script>