<div id="box-pacman" class="row-fluid">
    <div class="row-fluid pagination-centered">
        <div class='span5'>
          <h3>DNS</h3>
          <div class="row-fluid">

            <h4>Primários</h4>
            <div class="row-fluid">
                <% @hash_result[:servers].each do |server, value| %>
                  <% if value[:primary] %>
                  <a id='clicou' href="javascript:popupTable()">
                      <div class="pacmanchartsP" id="chart-pacman-<%= server %>"></div>
                    </a>
                      <% end %>
                <% end %>
              </div>
            <div id="legendas" style="position: absolute; margin-top:5px;">
              <div>
                  <span class="label" style="background-color:#DBF0FF; border: 1px solid #D4D4D4;color:#274B6D;line-height: 20px;">&nbsp;Principal&nbsp;</span>
                  <span class="label " style="background-color:#F5F5F5;border: 1px solid #D4D4D4;color:#274B6D;line-height: 20px;">&nbsp;VIP&nbsp;</span>
              </div>
              <div>

              </div>
            </div>
            <h4>Secundários</h4>
              <div id="secundarios" class="row-fluid">
                <% @hash_result[:servers].each do |server, value| %>
                    <% unless value[:primary] %>
                    <a id='clicou' href="javascript:popupTable()">
                      <div class="pacmanchartsS" id="chart-pacman-<%= server %>"></div>
                    </a>
                        <% end %>
                <% end %>

            </div>

          </div>
          <ul class="breadcrumb">
            <li><span class="label" style="background-color:#00E603;">&nbsp;&nbsp;OK&nbsp;&nbsp;</span>
            </li>
            <li><span class="label" style="background-color:#ffd700;">&nbsp;NXDOMAIN&nbsp;</span>
            </li>
            <li><span class="label" style="background-color:#E89700;">&nbsp;FORMERR&nbsp;</span>
            </li>
            <li><span class="label" style="background-color:#D60000;">&nbsp;SERVFAIL&nbsp;</span>
            </li>
            <li><span class="label" style="background-color:#1540EB;">&nbsp;TIMEOUT&nbsp;</span>
            </li>
            <li><span class="label" style="background-color:#757575;">&nbsp;REFUSED&nbsp;</span>
            </li>
            <li><span class="label" style="background-color:#000000;">&nbsp;OTHER&nbsp;</span>
            </li>

          </ul>
        </div>
        <div id="table-div" class='span7' style="margin-top:70px;">
          <table class="table table-bordered table-hover table-condensed">
            <thead>
                <tr>
                  <th>Piores URLs</th>
                  <% DnsResult.possible_status.each do |status| %>
                  <th><a href="#" rel="tooltip" title="<%=status%>"><%=status[0..1]%></a></th>
                      <%end%>
                </tr>
            </thead>
            <tbody>
            <% if @hash_result[:sites].empty? %>
                <td colspan="8">Nenhum site encontrado.</td>
            <%end%>
            <% @hash_result[:sites].each do |address, errors| %>
                <tr>
                  <td><%= address %></td>
                  <td><%= (errors[:OK]/errors[:total])*100 %>%</td>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                </tr>
            <% end %>
            </tbody>
          </table>
          <table class="table table-bordered table-hover table-condensed">
            <thead>
            <tr>
              <th>Piores Sondas</th>
              <% DnsResult.possible_status.each do |status| %>
                  <th><a href="#" rel="tooltip" title="<%=status%>"><%=status[0..1]%></a></th>
              <%end%>
            </tr>
            </thead>
            <tbody>

            <% if @hash_result[:probes].empty? %>
                <td colspan="8">Nenhuma sonda encontrada.</td>
            <%end%>

                <% @hash_result[:probes].each do |name, values| %>
                <tr>
                  <td>
                    <%= image_tag "icons/"+values[:type]+"16.png" %>
                    "<%= name %>"
                  </td>
                  <td><%= (values[:OK]/values[:total])*100 %>%</td>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                  <td>0</td>
                </tr>
            <% end %>
            </tbody>
          </table>
        </div>
      </div>
      <%= debug @hash_result %>
    <div class="row-fluid">
      <div class="span12">
        <div class="chart-bottom" style="padding-top: 10px;">
          <div class="btn btn-danger" style="float:right; margin-bottom: 20px" onclick="jQuery('#box-pacman').remove();">Remover</div>

        </div>
    </div>
  <div id="details-table" class="modal hide fade"></div>
</div>
</div>
<% @hash_result[:servers].each do |server, value| %>
    <%= debug value[:errors]%>
    <%end%>
<script type="text/javascript">
    $(document).ready(function () {
       $("[rel=tooltip]").tooltip();
        var element = document.getElementsByClassName('pacmanchartsP');
        var element2 = document.getElementsByClassName('pacmanchartsS');
        if(element.length <=6)
            $('.pacmanchartsP').attr('style', 'width:' + 100/element.length +'%;height:150px;float:left');
        if(element2.length <=6)
            $('.pacmanchartsS').attr('style', 'width:' + 100/element2.length +'%;height:150px;float:left;');
        if(element2.length ==0)
            jQuery('#secundarios').html('').append($("<h5 />").text('Não há servidores desta categoria.'));



    });


    Highcharts.setOptions({
        colors: ['#00E603', '#ffd700', '#E89700','#D60000','#1540EB','#757575','#000000' ]
    });

    var servers = [<% @hash_result[:servers].each do |server, value| %> {
        name: "<%= value[:name].nil? ? "" : value[:name][0] %>",
        address: "<%= server %>",
        ok : <%=value[:errors][:OK]%>,
        timeout :<%=value[:errors][:TIMEOUT]%>,
        serverfail :<%=value[:errors][:SERVFAIL]%>,
        classe :"<%= value[:vip].nil? ? "" : (value[:vip][0] ? "vip" : "principal") %>",
        nx :<%=value[:errors][:NXDOMAIN]%>,
        fo :<%=value[:errors][:FORMERR]%>,
        re :<%=value[:errors][:REFUSED]%>,
        ot :<%=value[:errors][:OTHER]%>
    },<% end %>];

    for(var i in servers)  {
        var color;
        if(servers[i].classe=="vip")
            color='#F5F5F5'
        else
            color='#DBF0FF'
        DrawGraph(servers[i].name, servers[i].address, servers[i].ok, servers[i].nx, servers[i].fo, servers[i].serverfail, servers[i].timeout, servers[i].re, servers[i].ot, color);
    }

    function popupTable()
    {
        var e = document.getElementById('details-table');

        if (e.style.display == 'block'){
            e.style.display = 'none';
            document.getElementById('details-table').style.display = 'none';

        }else{
            if($('#details-table').is(':empty')){
                $.ajax({
                    dataType: '',
                    type: 'POST',
                    url: "<%= pacman_details_reports_url %>",
                    success: function(data){
                        $('#details-table').html(data).modal({show:true});
                    },
                    headers: {
                        'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
                    }
                });
            }
        }
        e.style.display = 'block';
        jQuery('#details-table').modal({show:true});

    }
    function DrawGraph(name, address, ok, nx, fo, serverfail,timeout,re, ot, backgroundColor){
    var hchart1 = new Highcharts.Chart({
        chart: {
            renderTo: 'chart-pacman-' + address,
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            backgroundColor: backgroundColor,
            borderColor: '#D4D4D4',
            borderWidth:1
        },
        title: {
            text: name
        },
        subtitle:{
            text: address
        },
        tooltip: {
            enabled: true,
            pointFormat: '{point.percentage:.1f}%'
        },
        plotOptions: {
            pie: {
                allowPointSelect: false,
                cursor: 'pointer',
                dataLabels: {
                    enabled: false
                },
                showInLegend: false,
                startAngle:90
            }
        },
        exporting: {
            enabled: false
        },
        series: [{
            type: 'pie',
            name: 'Browser share',
            data: [
                ['OK',   ok],
                ['NX', nx],
                ['FO', fo],
                ['SF',   serverfail],
                ['TO',   timeout],
                ['RE', re],
                ['OT', ot]
            ]
        }]
    });
    };


</script>